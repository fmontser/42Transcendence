<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Pong Test Client</title>
	<style>
		body {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			margin: 0;
			background-color: #1a1a1a;
		}
		canvas {
			border: 2px solid white;
		}
		#score {
			position: absolute;
			top: 20px;
			color: white;
			font-size: 24px;
			font-family: monospace;
		}
	</style>
</head>
<body>
	<div>
		<div id="score">0 - 0</div>
		<canvas id="pongCanvas" width="1280" height="720"></canvas>
	</div>

	<script>
		const ws = new WebSocket(`wss://${window.location.hostname}:8443/serverpong/front/get/pong`);
		const canvas = document.getElementById('pongCanvas');
		const ctx = canvas.getContext('2d');
		const scoreElement = document.getElementById('score');

		// ConfiguraciÃ³n del juego
		const PADDLE_WIDTH = 64;
		const PADDLE_HEIGHT = 256;
		const BALL_RADIUS = 32;

		// Estado inicial
		let gameState = {
			ball: { x: canvas.width/2, y: canvas.height/2 }, // La pelota sigue centrada
			paddles: [
				{ x: 32, y: (canvas.height - PADDLE_HEIGHT)/2 }, // Paddle izquierdo, anclado a esquina
				{ x: canvas.width - 32 - PADDLE_WIDTH, y: (canvas.height - PADDLE_HEIGHT)/2 } // Paddle derecho, anclado a esquina
			],
			score: [0, 0]
		};

		// Manejo de WebSocket
		ws.onopen = () => {
			console.log('Conectado al servidor');
			ws.send(JSON.stringify({ type: 'newGame' }));
		};

		ws.onmessage = (event) => {
			gameState = JSON.parse(event.data);
			drawGame();
			scoreElement.textContent = `${gameState.score[0]} - ${gameState.score[1]}`;
		};

		ws.onclose = () => {
			console.log('Desconectado del servidor');
		};

		// Dibujar el juego
		function drawGame() {
			// Limpiar canvas
			ctx.fillStyle = '#1a1a1a';
			ctx.fillRect(0, 0, canvas.width, canvas.height);

			// Dibujar paddles (ahora sin ajuste de centro)
			ctx.fillStyle = 'white';
			gameState.paddles.forEach(paddle => {
				ctx.fillRect(
					paddle.x,
					paddle.y,
					PADDLE_WIDTH,
					PADDLE_HEIGHT
				);
			});

			// Dibujar pelota (mantiene coordenadas centradas)
			ctx.beginPath();
			ctx.arc(gameState.ball.x, gameState.ball.y, BALL_RADIUS, 0, Math.PI * 2);
			ctx.fill();
		}

		// Control de teclado
		document.addEventListener('keydown', (event) => {
			let input = { type: 'input', playerId: 0, direction: 'stop' };
			
			switch(event.key) {
				case 'w':
					input.direction = 'up';
					input.playerId = 0;
					break;
				case 's':
					input.direction = 'down';
					input.playerId = 0;
					break;
				case 'ArrowUp':
					input.direction = 'up';
					input.playerId = 1;
					break;
				case 'ArrowDown':
					input.direction = 'down';
					input.playerId = 1;
					break;
			}
			
			ws.send(JSON.stringify(input));
		});

		document.addEventListener('keyup', (event) => {
			let input = { type: 'input', playerId: 0, direction: 'stop' };
			
			switch(event.key) {
				case 'w':
				case 's':
					input.playerId = 0;
					break;
				case 'ArrowUp':
				case 'ArrowDown':
					input.playerId = 1;
					break;
			}
			
			ws.send(JSON.stringify(input));
		});

		// Dibujar estado inicial
		drawGame();
	</script>
</body>
</html>